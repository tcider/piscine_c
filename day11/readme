
Don't forget check for malloc - 

if ((p = (char*)malloc(......)))

else
	Error
